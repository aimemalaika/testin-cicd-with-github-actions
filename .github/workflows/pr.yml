name: Create Pull Request to Production

on:
  push:
    branches:
      - main

jobs:
  create_pull_request:
    name: Create Pull Request
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      
    - name: Check if production branch exists
      id: branch_check
      run: |
        git ls-remote --exit-code . refs/heads/production
        echo "::set-output name=branch_exists::true"
      continue-on-error: true
    
    - name: Create Production Branch
      if: steps.branch_check.outputs.branch_exists != 'true'
      run: |
        git checkout -b production
        git push origin production
      
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: Automatically create pull request to production
        title: Automatic Pull Request to Production
        body: |
          This pull request is automatically generated when the `main` branch receives updates.
        branch: production
        base: main
