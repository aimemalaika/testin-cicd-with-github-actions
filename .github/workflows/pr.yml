name: Create Pull Request to Production

on:
  push:
    branches:
      - main

jobs:
  create_pull_request:
    name: Create Pull Request
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      
    - name: Create Pull Request
      id: create_pr
      uses: peter-evans/create-pull-request@v3
      with:
        token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        commit-message: Automatically create pull request to production
        title: Automatic Pull Request to Production
        body: |
          This pull request is automatically generated when the `main` branch receives updates.
        branch: production
        base: main
        draft: true

    - name: Prevent automatic merging
      run: |
        echo "pull_request:\n  auto_merge: false" >> $GITHUB_EVENT_PATH
      if: steps.create_pr.outputs.pull-request-number

